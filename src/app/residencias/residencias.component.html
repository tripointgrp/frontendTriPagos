<div class="residencias-container">
  <!-- Encabezado -->
  <div class="residencias-header">
    <h2>Gestión de Residencias</h2>
    <button class="tp-btn tp-btn--green" (click)="resetForm(); showModal = true">
      + Nueva Residencia
    </button>
  </div>

  <!-- Tabla -->
  <div class="table-card">
    <table class="tp-table">
      <thead>
        <tr>
          <th>Código</th>
          <th>Unidad</th>
          <th>Torre</th>
          <th>Estado</th>
          <th class="acciones-col">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of residencias">
          <td>{{ r.codigo_residencia }}</td>
          <td>{{ getNombreUnidad(r.unidadId) }}</td>

          <td>{{ r.torre || 'Única' }}</td>
          <td>
            <label class="switch">
              <input type="checkbox" [checked]="r.estado === 'activo'" (change)="toggleEstado(r)" />
              <span class="slider"></span>
            </label>
          </td>
          <td class="acciones">
            <button (click)="editarResidencia(r)" class="icon-btn edit">
              <span class="material-symbols-outlined">edit</span>
            </button>
            <button (click)="eliminarResidencia(r.id)" class="icon-btn delete">
              <span class="material-symbols-outlined">delete</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" *ngIf="showModal" (click)="showModal=false"></div>
<div class="modal" *ngIf="showModal">
  <div class="modal__head">
    <h3>{{ editando ? 'Editar Residencia' : 'Nueva Residencia' }}</h3>
    <button class="icon-btn" (click)="showModal=false">✕</button>
  </div>
  <div class="modal__body">
    <div class="field">
      <label>Código de Residencia</label>
      <input type="text" [(ngModel)]="nuevaResidencia.codigo_residencia" placeholder="Ej. A-101" />
    </div>

    <div class="field">
      <label>Unidad</label>
      <select [(ngModel)]="nuevaResidencia.unidadId" (change)="cargarTorresDeUnidad(nuevaResidencia.unidadId)">
        <option value="" disabled selected>Selecciona una unidad</option>
        <option *ngFor="let u of unidades" [value]="u.id">{{ u.nombre }}</option>
      </select>
    </div>

    <div class="field" *ngIf="torresDisponibles.length">
      <label>Torre</label>
      <select [(ngModel)]="nuevaResidencia.torre">
        <option value="">Única</option>
        <option *ngFor="let t of torresDisponibles" [value]="t.nombre">{{ t.nombre }}</option>
      </select>
    </div>

    <div class="field">
      <label>Estado</label>
      <label class="switch">
        <input type="checkbox"
               [ngModel]="nuevaResidencia.estado === 'activo'"
               (ngModelChange)="nuevaResidencia.estado = $event ? 'activo' : 'inactivo'"/>
        <span class="slider"></span>
      </label>
    </div>
  </div>
  <div class="modal__foot">
    <button class="tp-btn" (click)="showModal=false">Cancelar</button>
    <button class="tp-btn tp-btn--green" (click)="guardarResidencia()">
      {{ editando ? 'Actualizar' : 'Agregar' }}
    </button>
  </div>
</div>
