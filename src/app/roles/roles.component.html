<div class="roles-container">
  <!-- Encabezado -->
  <div class="roles-header">
    <h2>Gestión de Roles</h2>
    <button
      class="tp-btn tp-btn--green"
      (click)="resetForm(); showModal = true"
    >
      + Nuevo Rol
    </button>
  </div>

  <!-- Tabla -->
  <div class="table-card">
    <table class="tp-table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Descripción</th>
          <th>Permisos</th>
          <th class="acciones-col">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let rol of roles">
          <td>{{ rol.nombre }}</td>
          <td>{{ rol.descripcion }}</td>
          <td>
            <span *ngFor="let p of rol.permisos" class="badge badge--perm">{{
              p
            }}</span>
          </td>
          <td class="acciones">
            <button
              (click)="editarRol(rol); showModal = true"
              class="icon-btn edit"
            >
              <span class="material-symbols-outlined">edit</span>
            </button>
            <button (click)="eliminarRol(rol.id)" class="icon-btn delete">
              <span class="material-symbols-outlined">delete</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal para agregar/editar -->
<div class="modal-backdrop" *ngIf="showModal" (click)="showModal = false"></div>
<div class="modal" *ngIf="showModal">
  <div class="modal__head">
    <h3>{{ editando ? "Editar Rol" : "Nuevo Rol" }}</h3>
    <button class="icon-btn" (click)="showModal = false">✕</button>
  </div>
  <div class="modal__body">
    <div class="field">
      <label>Nombre del Rol</label>
      <input
        type="text"
        [(ngModel)]="nuevoRol.nombre"
        placeholder="Ej. Administrador"
      />
    </div>
    <div class="field">
      <label>Descripción</label>
      <textarea
        [(ngModel)]="nuevoRol.descripcion"
        placeholder="Describe las funciones de este rol..."
      ></textarea>
    </div>
    <div class="field">
      <label>Permisos</label>
      <div class="checkbox-group">
        <label *ngFor="let permiso of permisosDisponibles">
          <input
            type="checkbox"
            [checked]="tienePermiso(permiso)"
            (change)="togglePermiso(permiso)"
          />
          {{ permiso }}
        </label>
      </div>
    </div>
  </div>
  <div class="modal__foot">
    <button class="tp-btn" (click)="showModal = false">Cancelar</button>
    <button class="tp-btn tp-btn--green" (click)="guardarRol()">
      {{ editando ? "Actualizar" : "Agregar" }}
    </button>
  </div>
</div>
